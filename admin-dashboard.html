<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AquaFlow Tech</title>
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        // Fallback if primary CDN fails
        if (typeof Chart === 'undefined') {
            document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"><\/script>');
        }
    </script>
    <style>
        /* Global Fixes */
        body {
            overflow-x: hidden;
            background: var(--bg-primary) !important;
            background-image: none !important;
            min-height: 100vh;
        }

        /* Dashboard Wrapper */
        .dashboard-wrapper {
            display: flex;
            min-height: 100vh;
            width: 100%;
            padding-top: 0;
            background: var(--bg-primary);
        }

        /* Sidebar - Desktop Fixed (Hover Expand) */
        .dashboard-sidebar {
            width: 80px;
            /* Collapsed width */
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            height: 100vh;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            z-index: 2000;
            /* Layout Structure */
            display: flex;
            flex-direction: column;
            padding: 0;
            /* Handled by children */
            overflow: hidden;
            /* Prevent body scroll */
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1), box-shadow 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .sidebar-header {
            flex-shrink: 0;
            padding: 1rem 1.5rem;
            width: 100%;
            box-sizing: border-box;
            background: var(--bg-primary);
            /* Ensure opacity issues don't show background below */
        }

        .sidebar-nav {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            width: 100%;
            padding: 1rem 0;
        }

        /* Scrollbar Styling for nav */
        .sidebar-nav::-webkit-scrollbar {
            width: 5px;
        }

        .sidebar-nav::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        .sidebar-nav::-webkit-scrollbar-track {
            background: transparent;
        }

        /* Expand on Hover */
        .dashboard-sidebar:hover {
            width: 280px;
            box-shadow: var(--shadow-lg);
        }

        /* Show links on hover */
        .dashboard-sidebar:hover .link-text,
        .dashboard-sidebar:hover .header-text {
            opacity: 1 !important;
            transition-delay: 0s;
            /* Instant */
        }

        .dashboard-sidebar:hover .sidebar-header h3 {
            color: var(--text-primary);
        }

        /* Main Content - adjusted for fixed sidebar */
        .dashboard-main {
            flex: 1;
            margin-left: 80px;
            padding: 1rem 1.5rem;
            width: calc(100% - 80px);
            max-width: none;
            background: var(--bg-primary);
            min-height: 100vh;
            transition: margin 0.3s ease, width 0.3s ease;
        }

        /* RTL Support for Desktop Sidebar */
        [dir="rtl"] .dashboard-sidebar {
            left: auto;
            right: 0;
            border-right: none;
            border-left: 1px solid var(--border-color);
        }

        [dir="rtl"] .dashboard-main {
            margin-left: 0 !important;
            margin-right: 80px;
        }

        /* Adjust icon margin in RTL */
        [dir="rtl"] .sidebar-link i {
            margin-right: 0 !important;
            margin-left: 15px;
        }

        [dir="rtl"] .sidebar-header span {
            margin-left: 0 !important;
            margin-right: 12px;
        }

        /* Mobile / Tablet Responsiveness */
        @media (max-width: 991px) {
            .dashboard-sidebar {
                transform: translateX(-100%);
                /* Hide sidebar by default */
                background: var(--bg-primary);
                /* Ensure contrast */
                box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
                visibility: hidden;
                transition: transform 0.3s ease-in-out, visibility 0.3s;
                width: 85% !important;
                max-width: 300px;
            }

            .dashboard-main {
                margin-left: 0 !important;
                /* Reset margin */
                width: 100% !important;
                padding: 1.5rem;
            }

            /* Show sidebar when active class added */
            .dashboard-sidebar.active {
                transform: translateX(0);
                visibility: visible;
            }

            .dashboard-sidebar.active .link-text,
            .dashboard-sidebar.active .header-text {
                opacity: 1 !important;
            }

            .mobile-sidebar-toggle {
                display: flex !important;
            }

            .dashboard-overlay.active {
                display: block;
            }

            /* Admin Sidebar High Z-Index */
            .dashboard-sidebar {
                z-index: 9999 !important;
            }

            .mobile-close {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1.5rem;
                background: var(--bg-secondary);
                border-bottom: 1px solid var(--border-color);
                margin-bottom: 1rem;
                width: 100%;
            }

            .mobile-close button {
                background: var(--primary);
                border: none;
                width: 32px;
                height: 32px;
                border-radius: 50%;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
            }
        }

        .mobile-sidebar-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 10001;
            /* Above navbar if exists, above overly */
            background: var(--primary);
            border: none;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            font-size: 1.25rem;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .mobile-sidebar-toggle:active {
            transform: scale(0.95);
        }

        .dashboard-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9998 !important;
            /* Below sidebar */
            backdrop-filter: none;
            /* Prevent blur issues */
        }

        .chart-card {
            background: var(--bg-secondary);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        /* Desktop Navbar Overrides for Floating Dashboard Layout */
        @media (min-width: 992px) {
            .navbar {
                position: fixed !important;
                top: 1rem !important;
                left: calc(80px + 1rem) !important;
                /* Offset from sidebar */
                width: calc(100% - 80px - 2rem) !important;
                /* Full width minus sidebar and margins */
                border-radius: 1rem !important;
                margin: 0 !important;
                max-width: none !important;
                padding: 0.5rem 2rem !important;
                z-index: 1900 !important;
                background: var(--bg-secondary) !important;
                /* Ensure bg color */
                box-shadow: var(--shadow-sm);
            }

            .navbar .container {
                max-width: 100% !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* Ensure branding is visible in floating navbar */
            .navbar .navbar-brand {
                display: flex !important;
            }
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <!-- Navbar Removed -->

    <div class="dashboard-wrapper">
        <div class="dashboard-overlay" onclick="toggleSidebar()"></div>
        <!-- Sidebar Navigation -->
        <aside class="dashboard-sidebar">
            <div class="mobile-close" style="display: none;">
                <h3 style="margin:0; font-size: 1.1rem; color: var(--primary);">Menu</h3>
                <button onclick="toggleSidebar()"><i class="fas fa-times"></i></button>
            </div>
            <div class="sidebar-header"
                style="height: 70px; display: flex; align-items: center; padding: 0 1.5rem; margin-bottom: 1rem; overflow: hidden; white-space: nowrap;">
                <a href="index.html"
                    style="display: flex; align-items: center; text-decoration: none; color: inherit; width: 100%;">
                    <div class="brand-logo-box"
                        style="width: 32px; height: 32px; min-width: 32px; border-radius: 8px; background: url('assets/icons/favicon.svg') no-repeat center/contain;">
                    </div>
                    <span class="header-text"
                        style="margin-left: 12px; font-weight: 800; font-size: 1.25rem; color: var(--text-primary); opacity: 0; transition: opacity 0.2s;">AquaFlow
                        Tech</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <ul style="list-style: none;">
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#overview" class="sidebar-link active"
                            style="display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--text-secondary); text-decoration: none; transition: all 0.3s ease; white-space: nowrap; overflow: hidden;">
                            <i class="fas fa-chart-line"
                                style="min-width: 24px; margin-right: 15px; text-align: center; font-size: 1.1rem;"></i>
                            <span class="link-text" style="opacity: 0; transition: opacity 0.2s;">Overview</span>
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#operations" class="sidebar-link"
                            style="display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--text-secondary); text-decoration: none; transition: all 0.3s ease; white-space: nowrap; overflow: hidden;">
                            <i class="fas fa-cogs"
                                style="min-width: 24px; margin-right: 15px; text-align: center; font-size: 1.1rem;"></i>
                            <span class="link-text" style="opacity: 0; transition: opacity 0.2s;">Operations</span>
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#performance" class="sidebar-link"
                            style="display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--text-secondary); text-decoration: none; transition: all 0.3s ease; white-space: nowrap; overflow: hidden;">
                            <i class="fas fa-tachometer-alt"
                                style="min-width: 24px; margin-right: 15px; text-align: center; font-size: 1.1rem;"></i>
                            <span class="link-text" style="opacity: 0; transition: opacity 0.2s;">Performance</span>
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#insights" class="sidebar-link"
                            style="display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--text-secondary); text-decoration: none; transition: all 0.3s ease; white-space: nowrap; overflow: hidden;">
                            <i class="fas fa-users"
                                style="min-width: 24px; margin-right: 15px; text-align: center; font-size: 1.1rem;"></i>
                            <span class="link-text" style="opacity: 0; transition: opacity 0.2s;">Customer
                                Insights</span>
                        </a>
                    </li>
                    <li style="margin-bottom: 0.5rem;">
                        <a href="#resources" class="sidebar-link"
                            style="display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--text-secondary); text-decoration: none; transition: all 0.3s ease; white-space: nowrap; overflow: hidden;">
                            <i class="fas fa-boxes"
                                style="min-width: 24px; margin-right: 15px; text-align: center; font-size: 1.1rem;"></i>
                            <span class="link-text" style="opacity: 0; transition: opacity 0.2s;">Resources &
                                System</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="sidebar-footer"
                style="padding: 1rem; border-top: 1px solid var(--border-color); flex-shrink: 0;">
                <div style="display: flex; gap: 0.5rem; justify-content: center; margin-bottom: 0.5rem;">
                    <!-- Theme Toggle -->
                    <button class="theme-toggle" title="Toggle theme"
                        style="background: transparent; border: 1px solid var(--border-color); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; color: var(--text-primary); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-moon"></i>
                    </button>
                    <!-- RTL Toggle -->
                    <button class="rtl-toggle" title="Toggle RTL"
                        style="background: transparent; border: 1px solid var(--border-color); width: 32px; height: 32px; border-radius: 8px; cursor: pointer; color: var(--text-primary); display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-globe"></i>
                    </button>
                </div>
                <!-- Mobile Menu / Logout -->
                <div class="mobile-menu-toggle-wrapper" style="display: none;"> <!-- Hidden on desktop -->
                    <button class="mobile-menu-toggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
                <a href="index.html" class="sidebar-link"
                    style="display: flex; align-items: center; padding: 0.75rem 1rem; border-radius: 0.5rem; color: var(--error-color); text-decoration: none; transition: all 0.3s ease; white-space: nowrap; overflow: hidden;">
                    <i class="fas fa-sign-out-alt"
                        style="min-width: 24px; margin-right: 15px; text-align: center; font-size: 1.1rem;"></i>
                    <span class="link-text" style="opacity: 0; transition: opacity 0.2s;">Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <button class="mobile-sidebar-toggle" onclick="toggleSidebar()" style="margin-bottom: 1rem;">
                <i class="fas fa-bars"></i>
            </button>
            <div class="section-header" style="text-align: left; margin-bottom: 3rem; margin-top: 0; padding-top: 0;">
                <h2 class="section-title" style="font-size: 2.5rem; margin-top: 0;">Admin <span
                        class="gradient-text">Dashboard</span>
                </h2>
                <p class="section-subtitle" style="margin: 0;">Real-time System Analytics & Performance Indicators</p>
            </div>

            <!-- Overview Section -->
            <section id="overview" style="margin-bottom: 4rem; scroll-margin-top: 100px;">
                <div
                    style="display: flex; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    <i class="fas fa-chart-line"
                        style="font-size: 1.5rem; color: var(--accent-color); margin-right: 1rem;"></i>
                    <h3 style="font-size: 1.75rem; color: var(--text-primary); margin: 0;">Financial Overview</h3>
                </div>
                <div class="chart-grid" id="charts-overview"></div>
            </section>

            <!-- Operations Section -->
            <section id="operations" style="margin-bottom: 4rem; scroll-margin-top: 100px;">
                <div
                    style="display: flex; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    <i class="fas fa-cogs"
                        style="font-size: 1.5rem; color: var(--accent-color); margin-right: 1rem;"></i>
                    <h3 style="font-size: 1.75rem; color: var(--text-primary); margin: 0;">Operational Metrics</h3>
                </div>
                <div class="chart-grid" id="charts-operations"></div>
            </section>

            <!-- Performance Section -->
            <section id="performance" style="margin-bottom: 4rem; scroll-margin-top: 100px;">
                <div
                    style="display: flex; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    <i class="fas fa-tachometer-alt"
                        style="font-size: 1.5rem; color: var(--accent-color); margin-right: 1rem;"></i>
                    <h3 style="font-size: 1.75rem; color: var(--text-primary); margin: 0;">Technician & System
                        Performance</h3>
                </div>
                <div class="chart-grid" id="charts-performance"></div>
            </section>

            <!-- Insights Section -->
            <section id="insights" style="margin-bottom: 4rem; scroll-margin-top: 100px;">
                <div
                    style="display: flex; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    <i class="fas fa-users"
                        style="font-size: 1.5rem; color: var(--accent-color); margin-right: 1rem;"></i>
                    <h3 style="font-size: 1.75rem; color: var(--text-primary); margin: 0;">Customer Insights</h3>
                </div>
                <div class="chart-grid" id="charts-insights"></div>
            </section>

            <!-- Resources Section -->
            <section id="resources" style="margin-bottom: 4rem; scroll-margin-top: 100px;">
                <div
                    style="display: flex; align-items: center; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem;">
                    <i class="fas fa-boxes"
                        style="font-size: 1.5rem; color: var(--accent-color); margin-right: 1rem;"></i>
                    <h3 style="font-size: 1.75rem; color: var(--text-primary); margin: 0;">Resources & Inventory</h3>
                </div>
                <div class="chart-grid" id="charts-resources"></div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="main.js"></script>
    <script src="rtltoggle.js"></script>
    <script>
        function toggleSidebar() {
            const sidebar = document.querySelector('.dashboard-sidebar');
            const overlay = document.querySelector('.dashboard-overlay');
            if (sidebar) sidebar.classList.toggle('active');
            if (overlay) overlay.classList.toggle('active');

            const closeBtn = document.querySelector('.mobile-close');
            if (closeBtn && sidebar) {
                closeBtn.style.display = sidebar.classList.contains('active') ? 'flex' : 'none';
            }

            // Toggle body scroll
            if (sidebar && sidebar.classList.contains('active')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        }

        // Wait for window load to ensure all resources are ready
        window.addEventListener('load', function () {
            // Function to show loading in all sections
            const sections = ['overview', 'operations', 'performance', 'insights', 'resources'];
            sections.forEach(sec => {
                const el = document.getElementById(`charts-${sec}`);
                if (el) el.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: var(--text-secondary); padding: 2rem;"><i class="fas fa-spinner fa-spin"></i> Loading charts...</p>';
            });

            // Define 20 Distinct Chart Configurations with Categories
            const chartsConfig = [
                {
                    title: "Monthly Revenue Trend",
                    type: "line",
                    category: "overview",
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    data: [12000, 19000, 15000, 25000, 22000, 30000],
                    colors: ['rgba(75, 192, 192, 0.6)'],
                    borderColors: ['rgba(75, 192, 192, 1)'],
                    label: "Revenue ($)"
                },
                {
                    title: "Service Type Distribution",
                    type: "pie",
                    category: "operations",
                    labels: ['Leak Repair', 'Drain Cleaning', 'Installations', 'Maintenance', 'Emergency'],
                    data: [30, 25, 20, 15, 10],
                    colors: [
                        'rgba(255, 99, 132, 0.6)', 'rgba(54, 162, 235, 0.6)',
                        'rgba(255, 206, 86, 0.6)', 'rgba(75, 192, 192, 0.6)',
                        'rgba(153, 102, 255, 0.6)'
                    ],
                    label: "Requests"
                },
                {
                    title: "Technician Availability",
                    type: "bar",
                    category: "performance",
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    data: [8, 12, 14, 12, 10, 6, 4],
                    colors: ['rgba(54, 162, 235, 0.6)'],
                    label: "Active Techs"
                },
                {
                    title: "Customer Satisfaction Metrics",
                    type: "radar",
                    category: "insights",
                    labels: ['Punctuality', 'Quality', 'Price', 'Communication', 'Cleanliness'],
                    data: [4.8, 4.9, 4.2, 4.7, 4.9],
                    colors: ['rgba(153, 102, 255, 0.5)'],
                    borderColors: ['rgba(153, 102, 255, 1)'],
                    label: "Score (out of 5)"
                },
                {
                    title: "Inventory Status (Parts)",
                    type: "doughnut",
                    category: "resources",
                    labels: ['Pipes', 'Faucets', 'Connectors', 'Valves', 'Seals'],
                    data: [500, 200, 800, 300, 600],
                    colors: [
                        '#22d3ee', '#0d9488', '#f59e0b', '#ef4444', '#6366f1'
                    ],
                    label: "Stock Count"
                },
                {
                    title: "Response Time by Region",
                    type: "polarArea",
                    category: "operations",
                    labels: ['North', 'South', 'East', 'West', 'Central'],
                    data: [25, 40, 15, 30, 20],
                    colors: [
                        'rgba(255, 99, 132, 0.5)', 'rgba(54, 162, 235, 0.5)',
                        'rgba(255, 206, 86, 0.5)', 'rgba(75, 192, 192, 0.5)',
                        'rgba(153, 102, 255, 0.5)'
                    ],
                    label: "Minutes"
                },
                {
                    title: "Quarterly Growth",
                    type: "line",
                    category: "overview",
                    labels: ['Q1', 'Q2', 'Q3', 'Q4'],
                    data: [5, 12, 18, 25],
                    fill: true,
                    colors: ['rgba(34, 197, 94, 0.2)'],
                    borderColors: ['#22c55e'],
                    label: "Growth %"
                },
                {
                    title: "Top Performing Technicians",
                    type: "bar",
                    category: "performance",
                    labels: ['Alex', 'Sam', 'Jordan', 'Casey', 'Jamie'],
                    indexAxis: 'y',
                    data: [95, 88, 92, 85, 90],
                    colors: ['rgba(244, 114, 182, 0.7)'],
                    label: "Jobs Completed"
                },
                {
                    title: "Lead Sources",
                    type: "pie",
                    category: "insights",
                    labels: ['Website', 'Referral', 'Social Media', 'Ads', 'Direct'],
                    data: [40, 30, 15, 10, 5],
                    colors: [
                        '#60a5fa', '#34d399', '#f472b6', '#fbbf24', '#a78bfa'
                    ],
                    label: "Leads"
                },
                {
                    title: "Service Expenses Breakdown",
                    type: "doughnut",
                    category: "resources",
                    labels: ['Labor', 'Materials', 'Transport', 'Marketing', 'Overhead'],
                    data: [45, 30, 10, 10, 5],
                    colors: [
                        '#ef4444', '#f97316', '#eab308', '#84cc16', '#06b6d4'
                    ],
                    label: "Expense %"
                },
                {
                    title: "Customer Age Demographics",
                    type: "bar",
                    category: "insights",
                    labels: ['18-24', '25-34', '35-44', '45-54', '55+'],
                    data: [10, 35, 30, 15, 10],
                    colors: ['rgba(124, 58, 237, 0.6)'],
                    label: "Percentage"
                },
                {
                    title: "Skill Competency Web",
                    type: "radar",
                    category: "performance",
                    labels: ['Plumbing', 'Electrical', 'HVAC', 'Customer Service', 'Safety'],
                    data: [90, 60, 40, 85, 95],
                    colors: ['rgba(14, 165, 233, 0.4)'],
                    borderColors: ['#0ea5e9'],
                    label: "Team Average"
                },
                {
                    title: "Monthly Cancellations",
                    type: "line",
                    category: "operations",
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    data: [5, 3, 4, 2, 6, 1],
                    borderColors: ['#f43f5e'],
                    colors: ['rgba(244, 63, 94, 0.1)'],
                    fill: true,
                    label: "Cancellations"
                },
                {
                    title: "Net Profit Margin",
                    type: "bar",
                    category: "overview",
                    labels: ['2020', '2021', '2022', '2023', '2024'],
                    data: [15, 18, 22, 20, 25],
                    colors: ['#10b981'],
                    label: "Margin %"
                },
                {
                    title: "Service Request Priority",
                    type: "doughnut",
                    category: "operations",
                    labels: ['Critical', 'High', 'Medium', 'Low'],
                    data: [10, 25, 40, 25],
                    colors: ['#dc2626', '#f97316', '#3b82f6', '#22c55e'],
                    label: "Requests"
                },
                {
                    title: "Average Ticket Value",
                    type: "line",
                    category: "overview",
                    labels: ['Wk 1', 'Wk 2', 'Wk 3', 'Wk 4'],
                    data: [150, 180, 165, 210],
                    borderColors: ['#8b5cf6'],
                    tension: 0.1,
                    label: "Value ($)"
                },
                {
                    title: "Area Coverage Density",
                    type: "polarArea",
                    category: "operations",
                    labels: ['Zone A', 'Zone B', 'Zone C', 'Zone D', 'Zone E'],
                    data: [11, 16, 7, 3, 14],
                    colors: [
                        '#ff6384', '#4bc0c0', '#ffcd56', '#45b7d1', '#9966ff'
                    ],
                    label: "Active Jobs"
                },
                {
                    title: "Website Traffic",
                    type: "bar",
                    category: "insights",
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    data: [1200, 1500, 1100, 1700, 1600, 800, 600],
                    colors: ['rgba(54, 162, 235, 0.6)'],
                    label: "Visitors"
                },
                {
                    title: "Customer Retention",
                    type: "pie",
                    category: "insights",
                    labels: ['Returning', 'One-time'],
                    data: [65, 35],
                    colors: ['#059669', '#d1d5db'],
                    label: "Users"
                },
                {
                    title: "System Uptime",
                    type: "line",
                    category: "resources",
                    labels: ['00:00', '06:00', '12:00', '18:00', '24:00'],
                    data: [100, 99.9, 100, 99.8, 100],
                    borderColors: ['#06b6d4'],
                    stepped: true,
                    label: "Uptime %"
                }
            ];

            // Function to create a single chart
            function createChart(config, index) {
                // Determine target container
                const targetId = `charts-${config.category || 'overview'}`;
                const targetGrid = document.getElementById(targetId);

                if (!targetGrid) return; // Skip if container not found

                // Create Card
                const card = document.createElement('div');
                card.className = 'chart-card';

                const title = document.createElement('h3');
                title.textContent = config.title;

                const canvasContainer = document.createElement('div');
                canvasContainer.className = 'chart-container';

                const canvas = document.createElement('canvas');
                canvas.id = `chart-${index}`;

                canvasContainer.appendChild(canvas);
                card.appendChild(title);
                card.appendChild(canvasContainer);
                targetGrid.appendChild(card);

                // Use requestAnimationFrame to ensure DOM is painted before creating chart
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        const ctx = canvas.getContext('2d');
                        if (!ctx) {
                            console.error('Failed to get canvas context for chart:', index);
                            return;
                        }

                        const chartData = {
                            labels: config.labels,
                            datasets: [{
                                label: config.label || 'Data',
                                data: config.data,
                                backgroundColor: config.colors || 'rgba(54, 162, 235, 0.5)',
                                borderColor: config.borderColors || config.colors || 'rgba(54, 162, 235, 1)',
                                borderWidth: 1,
                                fill: config.fill || false,
                                tension: config.tension !== undefined ? config.tension : 0.4,
                                stepped: config.stepped || false
                            }]
                        };

                        const chartOptions = {
                            responsive: true,
                            maintainAspectRatio: false,
                            // Fix blurry charts - Force at least 2x pixel ratio for crisp text
                            devicePixelRatio: Math.max(window.devicePixelRatio || 1, 2),
                            indexAxis: config.indexAxis || 'x',
                            plugins: {
                                legend: {
                                    position: 'bottom',
                                    labels: {
                                        color: getComputedStyle(document.body).getPropertyValue('--text-primary') || '#333',
                                        font: {
                                            weight: 'bold',
                                            family: "'Inter', sans-serif"
                                        },
                                        usePointStyle: true,
                                        padding: 15
                                    }
                                }
                            },
                            scales: config.type === 'pie' || config.type === 'doughnut' || config.type === 'polarArea' || config.type === 'radar' ? {} : {
                                x: {
                                    ticks: {
                                        color: getComputedStyle(document.body).getPropertyValue('--text-secondary') || '#666',
                                        font: { weight: 'bold' }
                                    },
                                    grid: { color: 'rgba(200, 200, 200, 0.1)' }
                                },
                                y: {
                                    ticks: {
                                        color: getComputedStyle(document.body).getPropertyValue('--text-secondary') || '#666',
                                        font: { weight: 'bold' }
                                    },
                                    grid: { color: 'rgba(200, 200, 200, 0.1)' }
                                }
                            },
                            animation: {
                                duration: 800,
                                easing: 'easeOutQuart'
                            }
                        };

                        // Add radar/polar specific options
                        if (config.type === 'radar' || config.type === 'polarArea') {
                            chartOptions.scales = {
                                r: {
                                    grid: { color: 'rgba(200, 200, 200, 0.2)' },
                                    pointLabels: {
                                        color: getComputedStyle(document.body).getPropertyValue('--text-secondary') || '#666',
                                        font: {
                                            weight: 'bold',
                                            size: 11
                                        }
                                    },
                                    ticks: {
                                        backdropColor: 'transparent',
                                        font: { weight: 'bold' }
                                    }
                                }
                            };
                        }

                        try {
                            new Chart(ctx, {
                                type: config.type,
                                data: chartData,
                                options: chartOptions
                            });
                        } catch (e) {
                            console.error('Error creating chart:', index, config.title, e);
                        }
                    });
                });
            }

            // Render Charts with delay to ensure DOM is ready
            setTimeout(() => {
                if (typeof Chart === 'undefined') {
                    console.error('Chart.js not loaded');
                    sections.forEach(sec => {
                        const el = document.getElementById(`charts-${sec}`);
                        if (el) el.innerHTML = '<p class="text-center" style="grid-column: 1/-1; color: red;">Error: Chart.js library failed to load.</p>';
                    });
                    return;
                }

                // Clear loading state
                sections.forEach(sec => {
                    const el = document.getElementById(`charts-${sec}`);
                    if (el) el.innerHTML = '';
                });

                // Create all charts with staggered timing
                chartsConfig.forEach((config, index) => {
                    // Stagger chart creation to allow proper DOM layout
                    setTimeout(() => {
                        createChart(config, index);
                    }, index * 50);
                });
            }, 100);

            // Setup Smooth Scrolling for Sidebar Links
            document.querySelectorAll('.sidebar-link').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();

                    // Update Active State
                    document.querySelectorAll('.sidebar-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);

                    if (targetSection) {
                        const offsetTop = targetSection.getBoundingClientRect().top + window.pageYOffset - 100; // 100px offset for fixed header
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Highlight Sidebar Links on Scroll
            window.addEventListener('scroll', function () {
                let current = '';
                const sections = document.querySelectorAll('section');

                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.clientHeight;
                    // Trigger point for active state
                    if (pageYOffset >= (sectionTop - 150)) {
                        current = section.getAttribute('id');
                    }
                });

                document.querySelectorAll('.sidebar-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href').includes(current)) {
                        link.classList.add('active');
                    }
                });
            });
        });
    </script>
</body>

</html>